{"version":3,"file":"static/js/async/356.da73ea07.js","sources":["webpack://@sinsa/web/./src/components/AdaptiveAurorianCard/components/asc/index.tsx","webpack://@sinsa/web/./src/components/AdaptiveAurorianCard/hooks/use-lazy-image.ts","webpack://@sinsa/web/./src/components/AdaptiveAurorianCard/index.tsx","webpack://@sinsa/web/./src/components/RelativeTimeText/index.tsx","webpack://@sinsa/web/./src/components/SolutionCard/CopilotBlock/AdaptiveAuroriansTeam/index.tsx","webpack://@sinsa/web/./src/components/utils.ts","webpack://@sinsa/web/./src/services/solution-algorithm.ts","webpack://@sinsa/web/./src/views/SolutionView/DiffModal/helpers/patch.ts","webpack://@sinsa/web/./src/views/SolutionView/DiffModal/index.tsx","webpack://@sinsa/web/./src/views/SolutionView/QueryForm/utils.ts","webpack://@sinsa/web/./src/views/SolutionView/context.ts","webpack://@sinsa/web/./src/views/SolutionView/hooks/use-request-solution.ts","webpack://@sinsa/web/./src/views/SolutionView/hooks/use-trigger-form-action/constants.ts","webpack://@sinsa/web/./src/views/SolutionView/hooks/use-trigger-form-action/index.ts","webpack://@sinsa/web/./src/views/SolutionView/schemas/query-params.ts","webpack://@sinsa/web/./src/views/SolutionView/utils/without-exclude.ts"],"sourcesContent":["import clsx from 'clsx';\nimport React from 'react';\nimport styles from './styles.module.less';\n\ninterface AscProps {\n  rairty: number;\n  asc: number;\n}\n\nexport const IconAsc = React.memo<AscProps>(\n  ({ rairty }) => {\n    return (\n      <div\n        className={clsx(\n          styles.Asc,\n          rairty >= 4 ? styles.Icon3of3 : styles.Icon2of2,\n        )}\n      ></div>\n    );\n  },\n  (a, b) => a.asc === b.asc && a.rairty === b.rairty,\n);\n","import { useEffect, useRef } from 'react';\n\ninterface LazyImageOptions {\n  type?: 'awaken' | 'skin-1';\n}\n\nconst FileNameTypeMap: Record<string, LazyImageOptions | undefined> = {\n  bethel: { type: 'awaken' },\n  luke: { type: 'awaken' },\n  zarya: { type: 'skin-1' },\n  fleur: { type: 'awaken' },\n};\n\nexport function useLazyImage(aurorianId: string | undefined) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  useEffect(() => {\n    const loadImage = async () => {\n      if (aurorianId && containerRef.current) {\n        const options = FileNameTypeMap[aurorianId];\n        const filename = options?.type\n          ? `${aurorianId}-${options.type}`\n          : aurorianId;\n\n        containerRef.current.style.backgroundImage = `url(/assets/images/avatars/${filename}.webp)`;\n      }\n    };\n    loadImage();\n  }, [aurorianId]);\n\n  return {\n    containerRef,\n  };\n}\n","/* eslint-disable no-nested-ternary */\nimport React, { useMemo } from 'react';\nimport { useModel } from '@modern-js/runtime/model';\nimport type {\n  AurorianRequirementRemarkType,\n  AurorianNextType,\n} from '@sinsa/schema';\nimport clsx from 'clsx';\nimport type { MenuProps } from 'antd';\nimport { ConfigProvider, Flex, Rate, Tag, Dropdown } from 'antd';\nimport { useBreakpoint } from '@ant-design/pro-components';\nimport { m } from 'framer-motion';\nimport styles from './styles.module.less';\nimport { useLazyImage } from './hooks/use-lazy-image';\nimport {\n  AdaptiveAurorianCardMenuKey,\n  ClassURLMapper,\n  ElementURLMapper,\n} from './constants';\nimport { IconAsc } from './components/asc';\nimport { AuroriansModel } from '@/models/aurorians';\nimport { useSolutionResultContext } from '@/views/SolutionView/context';\nimport { QueryFormAction } from '@/views/SolutionView/hooks/use-trigger-form-action/constants';\nimport { GLOBAL_THEME } from '@/globalTheme';\n\ninterface AdaptiveArurorianCardProps {\n  aurorianId: string;\n  breakthrough?: number;\n  remark?: AurorianRequirementRemarkType;\n  readOnly?: boolean;\n  mini?: boolean;\n  onReplace?: (aurorian: AurorianNextType) => void;\n  hideMeta?: boolean;\n}\n\nexport const AdaptiveAurorianCard = React.memo<AdaptiveArurorianCardProps>(\n  ({\n    aurorianId: name,\n    breakthrough,\n    remark,\n    readOnly,\n    mini,\n    onReplace,\n    hideMeta,\n  }) => {\n    const [{ auroriansMap }] = useModel(AuroriansModel);\n    const aurorian = useMemo(\n      () => auroriansMap[name] as AurorianNextType | undefined,\n      [auroriansMap, name],\n    );\n    const { containerRef } = useLazyImage(aurorian?.aurorian_id);\n\n    const screen = useBreakpoint();\n    const rateTheme = useMemo(() => {\n      let starSize = 10;\n      switch (screen) {\n        case 'xs':\n          starSize = 10;\n          break;\n        case 'sm':\n          starSize = 12;\n          break;\n        default:\n          starSize = 13;\n          break;\n      }\n      return {\n        components: {\n          Rate: {\n            starBg: 'white',\n            starSize,\n          },\n        },\n      };\n    }, [screen]);\n\n    const items: MenuProps['items'] = useMemo(\n      () =>\n        [\n          {\n            label: `排除${aurorian?.cn_name}`,\n            key: AdaptiveAurorianCardMenuKey.IgnoreAurorian,\n          },\n          typeof breakthrough === 'number'\n            ? {\n                label: `仅排除此突破数的${aurorian?.cn_name}`,\n                key: AdaptiveAurorianCardMenuKey.IgnoreBreakthrough,\n              }\n            : null,\n          // {\n          //   label: `替换${aurorian?.cn_name}`,\n          //   key: AdaptiveAurorianCardMenuKey.ReplaceAurorian,\n          // },\n        ].filter(_ => _),\n      [aurorian?.cn_name, breakthrough],\n    );\n\n    const { triggerFormAction } = useSolutionResultContext();\n\n    return (\n      <Dropdown\n        disabled={readOnly}\n        trigger={['click']}\n        getPopupContainer={() => document.body}\n        menu={{\n          items,\n          onClick: ({ key }) => {\n            if (!aurorian?.aurorian_id) {\n              return;\n            }\n\n            switch (key) {\n              case AdaptiveAurorianCardMenuKey.IgnoreBreakthrough:\n                if (typeof breakthrough === 'number') {\n                  triggerFormAction({\n                    type: QueryFormAction.IgnoreAurorianBreakthroughOnly,\n                    aurorian,\n                    breakthrough,\n                  });\n                }\n\n                break;\n              case AdaptiveAurorianCardMenuKey.IgnoreAurorian:\n                triggerFormAction({\n                  type: QueryFormAction.IgnoreAurorian,\n                  aurorian,\n                });\n                break;\n\n              case AdaptiveAurorianCardMenuKey.ReplaceAurorian:\n                onReplace?.(aurorian);\n                break;\n              default:\n                break;\n            }\n          },\n        }}\n      >\n        <m.div\n          ref={containerRef}\n          className={clsx(\n            styles.AdaptiveAurorianCard,\n            styles.BackgroundImage,\n            readOnly && styles.Disabled,\n            mini ? styles.MiniSize : styles.LargeSize,\n          )}\n          whileHover={readOnly ? undefined : { opacity: 0.6 }}\n          whileTap={readOnly ? undefined : { opacity: 0.2 }}\n        >\n          {aurorian ? (\n            <>\n              <Flex vertical className={styles.NameContainer}>\n                <span>{aurorian?.cn_name}</span>\n                {typeof breakthrough === 'number' && aurorian?.rarity ? (\n                  <ConfigProvider theme={rateTheme}>\n                    <Rate\n                      className={styles.BreakThrough}\n                      disabled\n                      value={breakthrough}\n                      count={aurorian.rarity}\n                    />\n                  </ConfigProvider>\n                ) : null}\n              </Flex>\n              {hideMeta ? null : (\n                <Flex align=\"center\" className={styles.MetaContainer}>\n                  <img\n                    className={styles.MetaClass}\n                    alt={aurorian.profession}\n                    src={ClassURLMapper[aurorian.profession]}\n                  />\n                  <Flex align=\"center\" vertical={mini}>\n                    <img\n                      className={styles.MetaFirstAttribute}\n                      alt={aurorian.primary_element}\n                      src={ElementURLMapper[aurorian.primary_element]}\n                    />\n                    {aurorian.secondary_element ? (\n                      <img\n                        className={styles.MetaSecondAttribute}\n                        alt={aurorian.secondary_element}\n                        src={ElementURLMapper[aurorian.secondary_element]}\n                      />\n                    ) : null}\n                  </Flex>\n                </Flex>\n              )}\n            </>\n          ) : null}\n          {remark?.replace?.type === 'any' && remark?.replace?.any === 'All' ? (\n            <Tag\n              className={styles.ReplaceableTag}\n              color={GLOBAL_THEME.primaryColor}\n            >\n              可替\n            </Tag>\n          ) : null}\n          {remark?.replace?.type === 'any' && remark?.replace?.any === 'DPS' ? (\n            <Tag\n              className={styles.ReplaceableTag}\n              color={GLOBAL_THEME.primaryColor}\n            >\n              可替输出\n            </Tag>\n          ) : null}\n          {remark?.replace?.type === 'any' && remark?.replace?.any === 'TP' ? (\n            <Tag\n              className={styles.ReplaceableTag}\n              color={GLOBAL_THEME.primaryColor}\n            >\n              可替位移\n            </Tag>\n          ) : null}\n          {remark?.replace?.type === 'any' &&\n          remark?.replace?.any === 'Heal' ? (\n            <Tag\n              className={styles.ReplaceableTag}\n              color={GLOBAL_THEME.primaryColor}\n            >\n              可替治疗\n            </Tag>\n          ) : null}\n          {remark?.replace?.type === 'any' ? null : aurorian?.rarity &&\n            remark?.level?.asc === 3 &&\n            typeof remark?.level?.lv === 'number' ? (\n            <Tag className={styles.RemarkContainer} color={'rgba(0,0,0,0.4)'}>\n              <Flex align=\"center\" gap={2}>\n                <IconAsc rairty={aurorian.rarity} asc={3} />\n                <span className={styles.num}>{remark?.level?.lv}</span>\n              </Flex>\n            </Tag>\n          ) : null}\n        </m.div>\n      </Dropdown>\n    );\n  },\n);\n","import { Tooltip } from 'antd';\nimport dayjs from 'dayjs';\nimport React from 'react';\nimport styles from './styles.module.less';\n\ninterface RelativeTimeTextProps {\n  time: Date;\n}\n\nexport const RelativeTimeText = React.memo<RelativeTimeTextProps>(\n  ({ time }) => {\n    return (\n      <Tooltip title={dayjs(time).format('YYYY-MM-DD HH:mm:ss')}>\n        <span className={styles.RelativeTimeText}>{dayjs(time).fromNow()}</span>\n      </Tooltip>\n    );\n  },\n  (prev, cur) => prev.time.valueOf() === cur.time.valueOf(),\n);\n","import type React from 'react';\nimport { Flex } from 'antd';\nimport type { AurorianNextType, CopilotNextType } from '@sinsa/schema';\nimport styles from './styles.module.less';\nimport { AdaptiveAurorianCard } from '@/components/AdaptiveAurorianCard';\n\ninterface AdaptiveAuroriansTeamProps {\n  aurorianRequirements: CopilotNextType['aurorian_requirements'];\n  readOnly?: boolean;\n  onReplace?: (aurorian: AurorianNextType) => void;\n}\n\nexport const AdaptiveAuroriansTeam: React.FC<AdaptiveAuroriansTeamProps> = ({\n  aurorianRequirements,\n  readOnly,\n  onReplace,\n}) => {\n  return (\n    <Flex className={styles.AuroriansTeam}>\n      {aurorianRequirements.map(({ aurorian_id, breakthrough, remark }) => {\n        return (\n          <AdaptiveAurorianCard\n            key={aurorian_id}\n            aurorianId={aurorian_id}\n            breakthrough={breakthrough}\n            remark={remark}\n            readOnly={readOnly}\n            onReplace={onReplace}\n          />\n        );\n      })}\n    </Flex>\n  );\n};\n","export function trimTitle(title: string): string {\n  return title\n    .replace('[白夜极光]', '')\n    .replace('【白夜极光】', '')\n    .replace('白夜极光', '')\n    .replace('荒典', '')\n    .replace('[hidden]', '');\n}\n","import type {\n  CalcOptions,\n  SolutionContext,\n  AllSolutions,\n} from '@sinsa/solution-calculator/dist/types/types';\n\nexport class SolutionAlgorithmService {\n  private static instance: SolutionAlgorithmService | null = null;\n\n  public static getInstance(): SolutionAlgorithmService {\n    if (SolutionAlgorithmService.instance === null) {\n      SolutionAlgorithmService.instance = new SolutionAlgorithmService();\n    }\n    return SolutionAlgorithmService.instance;\n  }\n\n  protected constructor() {\n    // noop\n  }\n\n  calculateAllSolutions(\n    context: SolutionContext,\n    k: number,\n    options: CalcOptions,\n  ): Promise<AllSolutions> {\n    return new Promise((resolve, reject) => {\n      const worker = new Worker(\n        new URL('@sinsa/solution-calculator', import.meta.url),\n      );\n\n      worker.addEventListener('message', event => {\n        const result = event.data;\n        resolve(result);\n        worker.terminate();\n      });\n\n      worker.addEventListener('error', error => {\n        reject(error);\n        worker.terminate();\n      });\n\n      worker.postMessage({ context, k, options });\n    });\n  }\n}\n\nexport const solutionAlgorithm = SolutionAlgorithmService.getInstance();\n","import type { AurorianRequirementType } from '@sinsa/schema';\nimport { produce } from 'immer';\nimport type { CopilotDiffType } from '../../schemas/query-params';\n\nexport function patchAurorianRequirements(\n  origin: [\n    AurorianRequirementType,\n    AurorianRequirementType,\n    AurorianRequirementType,\n    AurorianRequirementType,\n    AurorianRequirementType,\n  ],\n  diff: CopilotDiffType['auroriansReplace'],\n): [\n  AurorianRequirementType,\n  AurorianRequirementType,\n  AurorianRequirementType,\n  AurorianRequirementType,\n  AurorianRequirementType,\n] {\n  if (!diff) {\n    return origin;\n  }\n\n  return produce(origin, draft => {\n    for (const oneDiff of diff) {\n      const target = draft.find(t => t.aurorian_id === oneDiff.origin);\n      if (target) {\n        target.aurorian_id = oneDiff.alter.aurorianId;\n        target.breakthrough = oneDiff.alter.breakthrough;\n        delete target.remark;\n      }\n    }\n  });\n}\n","import { antdModalV5, create, useModal } from '@ebay/nice-modal-react';\nimport type {\n  AurorianNextType,\n  CopilotNextType,\n  TermNextType,\n} from '@sinsa/schema';\nimport { Button, Flex, Modal, Space, Tag, Tooltip, Typography } from 'antd';\nimport {\n  ProForm,\n  ProFormDependency,\n  ProFormDigit,\n  ProFormList,\n  ProFormRate,\n  ProFormSelect,\n} from '@ant-design/pro-components';\nimport numeral from 'numeral';\nimport { ArrowDown, ArrowRight, Delete } from '@icon-park/react';\nimport { useMemo } from 'react';\nimport { useModel } from '@modern-js/runtime/model';\nimport clsx from 'clsx';\nimport {\n  CopilotDiffSchema,\n  type CopilotDiffAuroriansReplaceType,\n  type CopilotDiffType,\n} from '../schemas/query-params';\nimport styles from './styles.module.less';\nimport { patchAurorianRequirements } from './helpers/patch';\nimport { AdaptiveAuroriansTeam } from '@/components/SolutionCard/CopilotBlock/AdaptiveAuroriansTeam';\nimport { RelativeTimeText } from '@/components/RelativeTimeText';\nimport { trimTitle } from '@/components/utils';\nimport { AuroriansModel, filterAuroriansOption } from '@/models/aurorians';\n\ninterface DiffModalProps {\n  type: 'create' | 'edit';\n  currentTerm: TermNextType;\n  originCopilot: CopilotNextType;\n  replaceAurorians: AurorianNextType[];\n}\n\nfunction ensureDiffKey(key: keyof CopilotDiffType) {\n  return key;\n}\n\nfunction ensureDiffReplaceKey(key: keyof CopilotDiffAuroriansReplaceType) {\n  return key;\n}\n\nexport const DiffModal = create<DiffModalProps>(\n  ({ originCopilot, currentTerm, replaceAurorians }) => {\n    const modal = useModal();\n    const [{ auroriansOptions, auroriansMap }] = useModel(AuroriansModel);\n\n    const [form] = ProForm.useForm<CopilotDiffType>();\n\n    const initialValues: Partial<CopilotDiffType> = {\n      copilotId: originCopilot.copilot_id,\n      auroriansReplace: replaceAurorians.length\n        ? replaceAurorians.map(a => {\n            return {\n              origin: a.aurorian_id,\n              alter: undefined,\n            } as any;\n          })\n        : undefined,\n    };\n\n    const displayTitle = useMemo(\n      () => trimTitle(originCopilot.title),\n      [originCopilot.title],\n    );\n\n    return (\n      <Modal\n        {...antdModalV5(modal)}\n        title={'替换作业中的光灵'}\n        width={'100%'}\n        onOk={() => {\n          form.submit();\n        }}\n        onCancel={() => {\n          form.resetFields();\n          modal.hide();\n        }}\n        className={styles.Modal}\n      >\n        <ProForm\n          onFinish={async values => {\n            console.log('submit', values);\n            modal.hide();\n          }}\n          form={form}\n          initialValues={initialValues}\n          submitter={false}\n          layout=\"horizontal\"\n        >\n          <Flex vertical gap={8}>\n            <div className={styles.PaddingContainer}>\n              <div className={styles.Title}>\n                <Typography.Link\n                  href={`https://www.bilibili.com/video/${originCopilot.href}`}\n                  target=\"_blank\"\n                  title={originCopilot.title}\n                  ellipsis={true}\n                >\n                  {currentTerm?.term_id &&\n                  originCopilot.term_id !== currentTerm.term_id ? (\n                    <Tooltip title={`复刻 ${originCopilot.term_id} 期荒典`}>\n                      <Tag color=\"red\">复刻</Tag>\n                    </Tooltip>\n                  ) : null}\n                  {displayTitle}\n                </Typography.Link>\n              </div>\n              <Flex className={styles.Header} wrap={'wrap'}>\n                <ProFormDependency name={[ensureDiffKey('diffScore')]}>\n                  {({ diffScore }: Pick<CopilotDiffType, 'diffScore'>) => {\n                    const showDeleted =\n                      typeof diffScore === 'number' && diffScore !== 0;\n                    return (\n                      <Flex align=\"center\" gap={4}>\n                        <span\n                          className={clsx(\n                            styles.Score,\n                            showDeleted && styles.Deleted,\n                          )}\n                        >\n                          {numeral(originCopilot.score).format('0,0')}\n                        </span>\n                        {showDeleted ? (\n                          <span className={clsx(styles.Score)}>\n                            {numeral(\n                              originCopilot.score + (diffScore ?? 0),\n                            ).format('0,0')}\n                          </span>\n                        ) : null}\n                      </Flex>\n                    );\n                  }}\n                </ProFormDependency>\n\n                <Flex className={styles.Author} align=\"center\" gap={6}>\n                  <Typography.Text strong>\n                    {originCopilot.author_name}\n                  </Typography.Text>\n\n                  <RelativeTimeText time={originCopilot.upload_time} />\n                </Flex>\n              </Flex>\n            </div>\n            <div className={styles.TeamsContainer}>\n              <AdaptiveAuroriansTeam\n                aurorianRequirements={originCopilot.aurorian_requirements}\n                readOnly\n              />\n            </div>\n\n            <div\n              className={styles.TeamsContainer}\n              style={{ marginBottom: '.5rem' }}\n            >\n              <ProFormDependency name={[ensureDiffKey('auroriansReplace')]}>\n                {({\n                  auroriansReplace,\n                }: Pick<CopilotDiffType, 'auroriansReplace'>) => {\n                  const parsed = CopilotDiffSchema.pick({\n                    auroriansReplace: true,\n                  }).safeParse({ auroriansReplace });\n                  if (parsed.success) {\n                    return (\n                      <>\n                        <Flex\n                          justify=\"center\"\n                          style={{ marginBottom: '.5rem' }}\n                        >\n                          <ArrowDown />\n                        </Flex>\n                        <AdaptiveAuroriansTeam\n                          aurorianRequirements={patchAurorianRequirements(\n                            originCopilot.aurorian_requirements,\n                            parsed.data.auroriansReplace,\n                          )}\n                          readOnly\n                        />\n                      </>\n                    );\n                  }\n\n                  return null;\n                }}\n              </ProFormDependency>\n            </div>\n            <ProFormList\n              name={ensureDiffKey('auroriansReplace')}\n              copyIconProps={false}\n              deleteIconProps={false}\n            >\n              {(field, index, action) => {\n                const { auroriansReplace } = form.getFieldsValue();\n                const originOptions = originCopilot.aurorian_requirements\n                  .filter(\n                    a =>\n                      !auroriansReplace?.find(\n                        target => target.origin === a.aurorian_id,\n                      ),\n                  )\n                  .map(a => {\n                    const au = auroriansMap[a.aurorian_id];\n                    return {\n                      label: au.cn_name,\n                      value: a.aurorian_id,\n                    };\n                  });\n                return (\n                  <Flex wrap={'wrap'} align=\"baseline\" gap={4}>\n                    <div>#{index + 1}</div>\n                    <ProFormSelect\n                      name={ensureDiffReplaceKey('origin')}\n                      options={originOptions}\n                      allowClear={false}\n                      placeholder={'想要替换的光灵'}\n                      rules={[{ required: true }]}\n                    />\n                    <ArrowRight />\n\n                    <ProFormSelect\n                      name={[ensureDiffReplaceKey('alter'), 'aurorianId']}\n                      options={auroriansOptions}\n                      showSearch\n                      allowClear={false}\n                      placeholder={'被替换的光灵，可拼音搜索'}\n                      fieldProps={{ filterOption: filterAuroriansOption }}\n                      rules={[{ required: true }]}\n                    />\n                    <Tooltip key=\"delete\" title=\"删除此替换光灵\">\n                      <Button\n                        style={{ marginLeft: '.3rem' }}\n                        icon={<Delete />}\n                        onClick={e => {\n                          e.stopPropagation();\n                          action.remove(field.name);\n                        }}\n                      />\n                    </Tooltip>\n                    <ProFormDependency\n                      name={[ensureDiffReplaceKey('alter'), 'aurorianId']}\n                    >\n                      {props => {\n                        if (props?.alter?.aurorianId) {\n                          const aurorian = auroriansMap[props.alter.aurorianId];\n                          return (\n                            <ProFormRate\n                              label={`${aurorian.cn_name}的光灵突破`}\n                              name={[\n                                ensureDiffReplaceKey('alter'),\n                                'breakthrough',\n                              ]}\n                              fieldProps={{\n                                count: aurorian.rarity,\n                                allowHalf: false,\n                              }}\n                              rules={[{ required: true }]}\n                            />\n                          );\n                        }\n                        return null;\n                      }}\n                    </ProFormDependency>\n                  </Flex>\n                );\n              }}\n            </ProFormList>\n            <Flex align=\"baseline\" gap={4}>\n              <ProFormDigit\n                width={'xs'}\n                name={ensureDiffKey('diffScore')}\n                placeholder={'分数变化'}\n                fieldProps={{ precision: 0 }}\n                min={-originCopilot.score}\n                max={5 * originCopilot.score}\n              />\n              <Space.Compact>\n                <Button\n                  onClick={() => {\n                    const { diffScore } = form.getFieldsValue();\n                    form.setFieldValue(\n                      ensureDiffKey('diffScore'),\n                      -Math.floor(originCopilot.score * 0.1) + (diffScore ?? 0),\n                    );\n                  }}\n                >\n                  分数减少 10%\n                </Button>\n                <Button\n                  onClick={() => {\n                    const { diffScore } = form.getFieldsValue();\n                    form.setFieldValue(\n                      ensureDiffKey('diffScore'),\n                      Math.floor(originCopilot.score * 0.1) + (diffScore ?? 0),\n                    );\n                  }}\n                >\n                  增加 10%\n                </Button>\n              </Space.Compact>\n            </Flex>\n          </Flex>\n        </ProForm>\n      </Modal>\n    );\n  },\n);\n","import type { QueryParamsType } from '../schemas/query-params';\n\nexport function ensureQueryKey(key: keyof QueryParamsType) {\n  return key;\n}\n","import constate from 'constate';\nimport { ProForm } from '@ant-design/pro-components';\nimport { useRequestSolution } from './hooks/use-request-solution';\nimport type { QueryParamsType } from './schemas/query-params';\nimport { useTriggerFormAction } from './hooks/use-trigger-form-action';\n\nexport const [SolutionResultProvider, useSolutionResultContext] = constate(\n  () => {\n    const { solutionResult, loadingSolutionResult, requestSolution } =\n      useRequestSolution();\n\n    const [form] = ProForm.useForm<QueryParamsType>();\n\n    const { triggerFormAction } = useTriggerFormAction(form);\n\n    return {\n      solutionResult,\n      loadingSolutionResult,\n      requestSolution,\n      form,\n      triggerFormAction,\n    };\n  },\n);\n","import { useRequest } from 'ahooks';\nimport { useModel } from '@modern-js/runtime/model';\nimport type { Solution } from '@sinsa/solution-calculator/dist/types/types';\nimport type { CopilotNextType } from '@sinsa/schema';\nimport type { QueryParamsType } from '../schemas/query-params';\nimport { withoutExclude } from '../utils/without-exclude';\nimport { AuroriansModel } from '@/models/aurorians';\nimport { solutionAlgorithm } from '@/services/solution-algorithm';\n\nexport function useRequestSolution() {\n  const [{ WHOLE_BOX }] = useModel(AuroriansModel);\n  const {\n    data: solutionResult,\n    loading: loadingSolutionResult,\n    runAsync: requestSolution,\n  } = useRequest(\n    async (\n      copilots: CopilotNextType[],\n      {\n        exclude,\n        k,\n        disableAlternative,\n        copilotsIgnore,\n        enableExclude,\n      }: QueryParamsType,\n    ) => {\n      const availableBox =\n        enableExclude && Array.isArray(exclude)\n          ? withoutExclude(WHOLE_BOX, exclude)\n          : WHOLE_BOX;\n\n      const allSolutions = await solutionAlgorithm.calculateAllSolutions(\n        {\n          copilots,\n          availableBox,\n        },\n        k,\n        { disableAlternative, copilotsIgnore },\n      );\n\n      const rankSet = new WeakMap<Solution, number>();\n      for (let i = 0; i < allSolutions.solutions.length; i++) {\n        const target = allSolutions.solutions[i];\n        rankSet.set(target, i);\n      }\n\n      return {\n        allSolutions,\n        rankSet,\n      };\n    },\n    {\n      manual: true,\n    },\n  );\n\n  return {\n    solutionResult,\n    loadingSolutionResult,\n    requestSolution,\n  };\n}\n","export enum QueryFormAction {\n  IgnoreAurorian = 'IgnoreAurorian',\n  IgnoreAurorianBreakthroughOnly = 'IgnoreAurorianBreakthroughOnly',\n  IgnoreCopilot = 'IgnoreCopilot',\n  ReplaceAurorian = 'ReplaceAurorian',\n}\n","import type { ProFormInstance } from '@ant-design/pro-components';\nimport type {\n  AurorianNextType,\n  CopilotNextType,\n  TermNextType,\n} from '@sinsa/schema';\nimport { useMemoizedFn } from 'ahooks';\nimport { show } from '@ebay/nice-modal-react';\nimport type {\n  ExcludeDataType,\n  QueryParamsType,\n} from '../../schemas/query-params';\nimport { ensureQueryKey } from '../../QueryForm/utils';\nimport { getNormalizeBreakthroughByRarity } from '../../utils/without-exclude';\nimport { DiffModal } from '../../DiffModal';\nimport { QueryFormAction } from './constants';\n\nexport type TriggerFormActionPayload =\n  | {\n      type: QueryFormAction.IgnoreAurorian;\n      aurorian: AurorianNextType;\n    }\n  | {\n      type: QueryFormAction.IgnoreAurorianBreakthroughOnly;\n      aurorian: AurorianNextType;\n      breakthrough: number;\n    }\n  | {\n      type: QueryFormAction.IgnoreCopilot;\n      copilot: CopilotNextType;\n    }\n  | {\n      type: QueryFormAction.ReplaceAurorian;\n      aurorian: AurorianNextType;\n      copilot: CopilotNextType;\n      currentTerm: TermNextType;\n    };\n\nexport function useTriggerFormAction(form: ProFormInstance<QueryParamsType>) {\n  const triggerFormAction = useMemoizedFn(\n    async (payload: TriggerFormActionPayload) => {\n      switch (payload.type) {\n        // 1. 排除单个作业\n        case QueryFormAction.IgnoreCopilot: {\n          const copilotsIgnore = form.getFieldValue(\n            ensureQueryKey('copilotsIgnore'),\n          );\n          const newCopilotsIgnore = Array.isArray(copilotsIgnore)\n            ? [...copilotsIgnore, payload.copilot.copilot_id]\n            : [payload.copilot.copilot_id];\n          form.setFieldValue(\n            ensureQueryKey('copilotsIgnore'),\n            newCopilotsIgnore,\n          );\n          break;\n        }\n\n        // 2. 排除单个光灵\n        case QueryFormAction.IgnoreAurorian:\n        case QueryFormAction.IgnoreAurorianBreakthroughOnly: {\n          form.setFieldValue(ensureQueryKey('enableExclude'), true);\n          const { exclude } = form.getFieldsValue();\n          // 光灵是否已经在排除列表里了\n          const existAurorianInfo = exclude?.find(\n            ex => ex.aurorianId === payload.aurorian.aurorian_id,\n          );\n          let clonedExclude = Array.isArray(exclude) ? Array.from(exclude) : [];\n          if (existAurorianInfo) {\n            clonedExclude = clonedExclude.filter(\n              info => info.aurorianId !== existAurorianInfo.aurorianId,\n            );\n          }\n          const newExclude: ExcludeDataType[] =\n            payload.type === QueryFormAction.IgnoreAurorianBreakthroughOnly\n              ? [\n                  ...clonedExclude,\n                  {\n                    aurorianId: payload.aurorian.aurorian_id,\n                    excludeBreakthroughOnly: true,\n                    excludeBreakthrough: getNormalizeBreakthroughByRarity(\n                      payload.breakthrough,\n                      payload.aurorian.rarity,\n                    ),\n                  },\n                ]\n              : [\n                  ...clonedExclude,\n                  { aurorianId: payload.aurorian.aurorian_id },\n                ];\n          form.setFieldValue(ensureQueryKey('exclude'), newExclude);\n\n          break;\n        }\n\n        // 3. 替换光灵\n        case QueryFormAction.ReplaceAurorian: {\n          console.log('replace', payload);\n          show(DiffModal, {\n            type: 'create',\n            currentTerm: payload.currentTerm,\n            originCopilot: payload.copilot,\n            replaceAurorians: [payload.aurorian],\n          }).catch(error => console.log(error));\n          break;\n        }\n\n        default:\n          break;\n      }\n      window.setTimeout(() => form.submit());\n    },\n  );\n\n  return {\n    triggerFormAction,\n  };\n}\n","import { z } from '@sinsa/schema';\n\nexport const ExcludeDataSchema = z.object({\n  aurorianId: z.string(),\n  excludeBreakthroughOnly: z.optional(z.boolean()),\n  excludeBreakthrough: z.optional(z.number()),\n});\n\nexport const CopilotDiffAuroriansReplaceSchema = z.object({\n  origin: z.string(),\n  alter: z.object({\n    aurorianId: z.string(),\n    breakthrough: z.number(),\n  }),\n});\n\nexport const CopilotDiffSchema = z.object({\n  copilotId: z.string().describe('作用的作业ID'),\n  diffScore: z.optional(z.number()).describe('分数差值'),\n  auroriansReplace: z.optional(z.array(CopilotDiffAuroriansReplaceSchema)),\n});\n\nexport const QueryParamsSchema = z.object({\n  k: z.number().min(1).max(4),\n  disableAlternative: z.optional(z.boolean()),\n  enableExclude: z.optional(z.boolean()),\n  exclude: z.optional(z.array(ExcludeDataSchema)),\n  enableSaveLocalStorage: z.optional(z.boolean()),\n  copilotsIgnore: z.optional(z.array(z.string())),\n  copilotsDiff: z.optional(z.array(CopilotDiffSchema)),\n});\n\nexport interface QueryParamsType extends z.infer<typeof QueryParamsSchema> {}\n\nexport interface ExcludeDataType extends z.infer<typeof ExcludeDataSchema> {}\n\nexport interface CopilotDiffType extends z.infer<typeof CopilotDiffSchema> {}\n\nexport interface CopilotDiffAuroriansReplaceType\n  extends z.infer<typeof CopilotDiffAuroriansReplaceSchema> {}\n","import { produce } from 'immer';\nimport type { AurorianRequirementType } from '@sinsa/schema';\nimport type { QueryParamsType } from '../schemas/query-params';\n\nexport function getNormalizeBreakthroughByRarity(\n  currentBreakthrough: number,\n  rarity: 1 | 2 | 3 | 4 | 5 | 6 | number,\n) {\n  switch (rarity) {\n    case 6:\n      return [0, 0, 3, 3, 3, 6].at(currentBreakthrough - 1)!;\n    case 5:\n      return [0, 2, 2, 2, 5].at(currentBreakthrough - 1)!;\n    case 4:\n      return [0, 0, 0, 4].at(currentBreakthrough - 1)!;\n    case 3:\n      return [0, 0, 3].at(currentBreakthrough - 1)!;\n    case 2:\n      return [0, 2].at(currentBreakthrough - 1)!;\n    case 1:\n      return [1].at(currentBreakthrough - 1)!;\n    default:\n      return 0;\n  }\n}\n\nexport function withoutExclude(\n  summaries: Record<\n    AurorianRequirementType['aurorian_id'],\n    AurorianRequirementType\n  >,\n  exclude: QueryParamsType['exclude'],\n) {\n  if (!exclude) {\n    return summaries;\n  }\n  return produce(summaries, draft => {\n    for (const {\n      excludeBreakthroughOnly,\n      excludeBreakthrough,\n      aurorianId,\n    } of exclude) {\n      // 如果是仅仅排除突破\n      if (excludeBreakthroughOnly) {\n        // 如果排除突破的要求 >= 1\n        if (\n          typeof excludeBreakthrough === 'number' &&\n          excludeBreakthrough >= 1\n        ) {\n          // const targetAurorian = auroriansMap[aurorianName];\n          // 那么说明 Box 里的该光灵的突破一定比排除突破小 1\n          draft[aurorianId].breakthrough = Math.max(excludeBreakthrough - 1, 0);\n        }\n      } else {\n        // 否则排除该光灵\n        delete draft[aurorianId];\n      }\n    }\n  });\n}\n"],"names":["IconAsc","rairty","className","a","b","asc","FileNameTypeMap","bethel","type","luke","zarya","fleur","useLazyImage","aurorianId","containerRef","useRef","useEffect","loadImage","current","options","filename","style","backgroundImage","AdaptiveAurorianCard","name","breakthrough","remark","readOnly","mini","onReplace","hideMeta","auroriansMap","useModel","AuroriansModel","aurorian","useMemo","aurorian_id","screen","useBreakpoint","rateTheme","starSize","components","Rate","starBg","items","label","cn_name","key","AdaptiveAurorianCardMenuKey","filter","_","triggerFormAction","useSolutionResultContext","Dropdown","disabled","trigger","getPopupContainer","document","body","menu","onClick","QueryFormAction","m","ref","whileHover","undefined","opacity","whileTap","Flex","vertical","rarity","ConfigProvider","theme","value","count","align","alt","profession","src","ClassURLMapper","primary_element","ElementURLMapper","secondary_element","replace","any","Tag","color","GLOBAL_THEME","level","lv","gap","RelativeTimeText","time","Tooltip","title","format","fromNow","prev","cur","valueOf","AdaptiveAuroriansTeam","aurorianRequirements","map","trimTitle","SolutionAlgorithmService","getInstance","instance","calculateAllSolutions","context","k","Promise","resolve","reject","worker","Worker","URL","addEventListener","event","data","terminate","error","postMessage","solutionAlgorithm","patchAurorianRequirements","origin","diff","produce","draft","oneDiff","target","find","t","alter","ensureDiffKey","ensureDiffReplaceKey","DiffModal","create","originCopilot","currentTerm","replaceAurorians","modal","useModal","auroriansOptions","form","ProForm","initialValues","copilotId","copilot_id","auroriansReplace","length","displayTitle","Modal","antdModalV5","width","onOk","submit","onCancel","resetFields","hide","onFinish","values","console","log","submitter","layout","Typography","href","ellipsis","term_id","wrap","ProFormDependency","diffScore","showDeleted","score","strong","author_name","upload_time","aurorian_requirements","marginBottom","parsed","CopilotDiffSchema","safeParse","success","justify","ArrowDown","ProFormList","copyIconProps","deleteIconProps","field","index","action","getFieldsValue","originOptions","au","ProFormSelect","allowClear","placeholder","rules","required","ArrowRight","showSearch","fieldProps","filterOption","filterAuroriansOption","Button","marginLeft","icon","Delete","e","stopPropagation","remove","props","ProFormRate","allowHalf","ProFormDigit","precision","min","max","Space","setFieldValue","Math","floor","ensureQueryKey","SolutionResultProvider","solutionResult","loadingSolutionResult","requestSolution","useRequestSolution","useTriggerFormAction","WHOLE_BOX","loading","runAsync","useRequest","copilots","exclude","disableAlternative","copilotsIgnore","enableExclude","availableBox","Array","isArray","withoutExclude","allSolutions","rankSet","WeakMap","i","solutions","set","manual","useMemoizedFn","payload","getFieldValue","newCopilotsIgnore","copilot","existAurorianInfo","ex","clonedExclude","from","info","newExclude","excludeBreakthroughOnly","excludeBreakthrough","getNormalizeBreakthroughByRarity","show","catch","window","setTimeout","ExcludeDataSchema","z","CopilotDiffAuroriansReplaceSchema","describe","enableSaveLocalStorage","copilotsDiff","currentBreakthrough","at","summaries"],"mappings":"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"}